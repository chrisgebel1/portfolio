{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | Projets BackOfice{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# Theme CSS navbarBO #}
    <link href="{{ asset('css/navbarBO.css')}}" rel="stylesheet">

    {# CSS pour eidt project #}
    <link href="{{ asset('css/editProjectBO.css')}}" rel="stylesheet">
{% endblock %}

{% block body %}

    {# Navigation BackOffice #}
    {% include 'admin/_navBackOffice.html.twig' %}

    <!-- Masthead -->
    <header class="mastheadBO bg-dark Merriweather">
        {# Messages Flash #}
        {% include '_messageFlash.html.twig' %}


        <div class="container h-100">
            <div class="row h-100 align-items-center justify-content-center text-center">
                <div class="col-lg-8 col-10 align-self-baseline">
                    {{ form_start(form) }}
                    {{ form_widget(form.name, {'attr': {'class': 'mb-3'}}) }}
                    {{ form_widget(form.type, {'attr': {'class': 'mb-3'}}) }}
                    {{ form_widget(form.category, {'attr': {'class': 'mb-3'}}) }}
                    {{ form_widget(form.info_short, {'attr': {'class': 'mb-3'}}) }}
                    {{ form_widget(form.info_long, {'attr': {'class': 'mb-3'}}) }}
                    {{ form_widget(form.files, {'attr': {'class': 'mb-3'}}) }}

                    <div class="form-group">
                        <button type="submit" class="btn btn-primary w-auto mt-4">Enregistrer</button>
                    </div>

                    {{ form_end(form) }}

                    {# Messages Flash #}
                    {% include 'admin/_imagesProject.html.twig' %}

{#                    <div class="d-flex flex-wrap justify-content-start">#}
{#                        {% if original_image %}#}
{#                            <div class="p-1 w-100 mx-auto mb-3 mt-4 bg-primary rounded text-white">Image(s) du projet</div>#}
{#                        {% for image in original_image %}#}
{#                            {% if loop.last and loop.length > 1 %}#}
{#                                {% set margeRight = "" %}#}
{#                            {% else %}#}
{#                                {% set margeRight = "mr-2" %}#}
{#                            {% endif %}#}
{#                                <div id="imageIndex{{ loop.index0 }}" class="container-delete {{ margeRight }} mb-5">#}
{#                                        <img src="{{ asset('img/portfolio/'~image) }}" alt="" width="125px" class="img-thumbnail deleteBtn" id="{{ loop.index0 }}">#}
{#                                    <div class="delete-img-btn-legend h-100 d-flex flex-column">#}
{#                                        <div>#}
{#                                            <a href="{{ path('app_admin_project_ajaxdeleteoneimageproject', {'id': project.id, 'img': loop.index0}) }}"#}
{#                                           data-indexImage="{{ loop.index0 }}" class="delete-img-btn text-white"#}
{#                                           onclick="return(confirm('Etes-vous sÃ»r de vouloir supprimer l\'image {{ loop.index }} ?'))">#}
{#                                                Supprimer#}
{#                                            </a>#}
{#                                        </div>#}
{#                                        <div class="mt-3">#}
{#                                            <a href="" class="text-white mr-3 order-move" data-order="{{ project.id }}-{{ loop.index0 }}-left" title="Modifier l'ordre"><i class="fas fa-angle-left"></i></a>#}
{#                                            <a href="" class="text-white ml-3 order-move" data-order="{{ project.id }}-{{ loop.index0 }}-right" title="Modifier l'ordre"><i class="fas fa-angle-right"></i></a>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}

{#                        {% endfor %}#}
{#                        {% else %}#}
{#                            <div class="p-1 w-100 mx-auto mb-3 mt-4 bg-primary rounded text-white">Il n'y a pas d'image(s) pour ce projet</div>#}
{#                        {% endif %}#}

{#                    </div>#}
                    <div class="mt-5"></div>

            </div>
            </div>
        </div>
    </header>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    {# My scripts for this template #}
    <script src="{{ asset('js/createProject.js') }}"></script>

    {# rollover des vignettes suppmrimer image du projet #}
    <script type="text/javascript">
        $(document).ready( function(){
            // "use strict";

            // $(".container-delete").mouseenter( function (){
            //     $(".delete-img-btn-legend",
            //         // this).stop().animate({"top":"0%",}, 200, 'swing');
            //         this).stop().fadeTo(50, 1);
            // });
            // $(".container-delete").mouseleave( function (){
            //     $(".delete-img-btn-legend",
            //         // this).stop().animate({"top":"100%",}, 200, 'swing');
            //         this).stop().fadeTo(50, 0);
            // });

            $(document).on('click', '.order-move', function(e){
                e.preventDefault();

                // console.log($(this)[0].dataset.order);
               // console.log($(this)[0].offsetParent.offsetParent.children[0].src);
                const $params = $(this)[0].dataset.order.split('-');
                const $p = $params[0];
                const $i = $params[1];
                const $o = $params[2];

                const $regex = /(?:(\w+\.\w+))$/gm;
                const $pathImg = $(this)[0].offsetParent.offsetParent.children[0].src;
                const $img = (RegExp($regex).exec($pathImg))[0];

                // console.log($params);

                const $responseConfirm = confirm('Voulez-vous vraiment modifier l\'odre ?');
                /* response => true (OK) ou false (ANNULER) */

                if ($responseConfirm) {
                    // console.log($paramProject);
                    // console.log($paramIndexImg);
                    // console.log($paramOrder);

                    $.ajax({
                        url:"{{ path('app_admin_project_ajaximageprojectorder') }}",
                        method:"POST",
                        data:{
                            project: $p,
                            img: $img,
                            indexImg: $i,
                            order: $o
                        },
                        dataType: "json",
                        success:function(data)
                        {
                            if ( data.status === 'success' ) {
                                // console.log(data);
                                $(".project-images").replaceWith(data.html);

                            } else if ( data.status === 'error' ) {
                                console.log(data);
                            }

                        },
                        error:function(x,e) {
                            if (x.status==0) {
                                alert('You are offline!!\n Please Check Your Network.');
                            } else if(x.status==404) {
                                alert('Requested URL not found.');
                            } else if(x.status==500) {
                                alert('Internel Server Error.');
                            } else if(e=='parsererror') {
                                alert('Error.\nParsing JSON Request failed.');
                            } else if(e=='timeout'){
                                alert('Request Time out.');
                            } else {
                                alert('Unknow Error.\n'+x.responseText);
                            }
                        }
                    });

                }

            });


        });
    </script>

{% endblock %}
